---
sudo: required
dist: bionic

notifications:
  slack:
    on_failure: always

matrix:
  fast_finish: true
  include:

# https://skaffold.dev/docs/install/
    - name: "deploy skaffold Python 3.8 on Windows"
      os: windows
      language: shell
      env:
        - PATH=/c/Python38:/c/Python38/Scripts:$PATH
      before_install:
        - choco install python
        # The command "pip install virtualenv" failed and exited with 127 during 
        # - pip install virtualenv
        # - virtualenv $HOME/venv
        # - source $HOME/venv/Scripts/activate
        - python --version
        # - pip install -r requirements.txt
      script:
        # download it and place it in your PATH as skaffold.exe.
        # https://storage.googleapis.com/skaffold/releases/latest/skaffold-windows-amd64.exe
        # - $version = (Invoke-RestMethod https://api.github.com/repos/argoproj/argo-cd/releases/latest).tag_name
        # - $url = "https://github.com/argoproj/argo-cd/releases/download/" + $version + "/argocd-windows-amd64.exe"
        - $url = "https://storage.googleapis.com/skaffold/releases/latest/skaffold-windows-amd64.exe"
        - $output = "skaffold-windows-amd64.exe"
        - Invoke-WebRequest -Uri $url -OutFile $output        
        - skaffold version
      after_success:
        - deactivate

# https://chocolatey.org/
# https://skaffold.dev/docs/install/
    - name: "deploy skaffold w chocolatey Python 3.8 on Windows"
      os: windows
      language: shell
      env:
        - PATH=/c/Python38:/c/Python38/Scripts:$PATH
      before_install:
        - choco install python
        # The command "pip install virtualenv" failed and exited with 127 during 
        # - pip install virtualenv
        # - virtualenv $HOME/venv
        # - source $HOME/venv/Scripts/activate
        - python --version
        # - pip install -r requirements.txt
      script:
        # download it and place it in your PATH as skaffold.exe.
        # https://storage.googleapis.com/skaffold/releases/latest/skaffold-windows-amd64.exe
        - choco install -y skaffold
        - skaffold version
      after_success:
        - deactivate
